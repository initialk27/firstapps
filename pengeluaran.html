<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pengeluaran Bulanan</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2 id="judul-bulan">...</h2>
    <p id="kosong-pengeluaran" style="text-align: center; color: gray;">Tidak ada pengeluaran</p>

    <div id="list-pengeluaran"></div>

    <button id="btn-tambah-pengeluaran" class="tambah">＋</button>
    <button id="btn-kembali" class="kembali">← Kembali</button>
  </div>

  <!-- Modal Konfirmasi -->
<div id="confirm-modal" class="modal">
  <div class="modal-box">
    <p>Do you want to delete?</p>
    <div class="modal-actions">
      <button id="confirm-yes">Yes</button>
      <button id="confirm-no">No</button>
    </div>
  </div>
</div>


  <script>
   const bulanIndex = localStorage.getItem("bulanTerpilih");
  const semuaBulan = JSON.parse(localStorage.getItem("catatanBulan")) || [];
  const dataBulan = semuaBulan[bulanIndex];
  const judulBulan = document.getElementById("judul-bulan");
  const list = document.getElementById("list-pengeluaran");

  if (!dataBulan) {
    alert("Data tidak ditemukan");
    location.href = "index.html";
  } else {
    judulBulan.textContent = `${dataBulan.bulan}, ${dataBulan.tahun}`;
  }

 function tampilkanPengeluaran() {
  const key = `pengeluaran-${bulanIndex}`;
  const data = JSON.parse(localStorage.getItem(key)) || [];
  list.innerHTML = "";

  const kosongMsg = document.getElementById("kosong-pengeluaran");
  kosongMsg.style.display = data.length === 0 ? "block" : "none";

  data.forEach((item, index) => {
    const tanggal = item.tanggal || "-";
    const nominal = typeof item.nominal === "number" ? item.nominal : 0;
    const keterangan = item.keterangan || "";

    const wrapper = document.createElement("div");
    wrapper.className = "pengeluaran-item";
    wrapper.style.position = "relative";

    wrapper.innerHTML = `
      <button class="menu-button" onclick="toggleMenu(this)">⋮</button>
      <div class="dropdown">
        <button onclick="editItem(${index})">Edit</button>
        <button onclick="confirmHapus(${index})">Hapus</button>
      </div>
      <div class="tanggal">${tanggal}</div>
      <div class="nominal">Rp ${nominal.toLocaleString()}</div>
      <div class="keterangan">${keterangan}</div>
    `;

    list.appendChild(wrapper);
  });
}



  document.getElementById("btn-tambah-pengeluaran").addEventListener("click", () => {
    window.location.href = "tambah-pengeluaran.html";
  });

  document.getElementById("btn-kembali").addEventListener("click", () => {
    window.location.href = "index.html";
  });

    window.toggleMenu = function (btn) {
    const dropdown = btn.nextElementSibling;
    const allDropdowns = document.querySelectorAll(".dropdown");
    allDropdowns.forEach(d => {
      if (d !== dropdown) d.style.display = "none";
    });
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  };

  let indexToDelete = null;

  window.confirmHapus = function(index) {
    indexToDelete = index;
    document.getElementById("confirm-modal").style.display = "flex";
  };

  window.editItem = function(index) {
    localStorage.setItem("editPengeluaranIndex", index);
    window.location.href = "edit-pengeluaran.html";
  };

  // Konfirmasi Hapus
  document.addEventListener("DOMContentLoaded", function () {
    const yesBtn = document.getElementById("confirm-yes");
    const noBtn = document.getElementById("confirm-no");

    if (yesBtn && noBtn) {
      yesBtn.addEventListener("click", function () {
        const key = `pengeluaran-${bulanIndex}`;
        const data = JSON.parse(localStorage.getItem(key)) || [];
        if (indexToDelete !== null) {
          data.splice(indexToDelete, 1);
          localStorage.setItem(key, JSON.stringify(data));
          tampilkanPengeluaran();
        }
        document.getElementById("confirm-modal").style.display = "none";
        indexToDelete = null;
      });

      noBtn.addEventListener("click", function () {
        document.getElementById("confirm-modal").style.display = "none";
        indexToDelete = null;
      });
    }
  });

  const data = localStorage.getItem('riwayatPengeluaran') || '';
const sizeInBytes = new Blob([data]).size;
console.log(`Ukuran: ${sizeInBytes} byte`);


  tampilkanPengeluaran();
  </script>
</body>
</html>
