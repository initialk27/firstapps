<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tambah Pengeluaran</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>Tambah Pengeluaran</h2>

    <div class="form-group">
      <label for="tanggal">Tanggal</label>
      <input type="date" id="tanggal" />
    </div>

    <div class="form-group">
      <label for="nominal">Nominal (Rp)</label>
      <input type="text" id="nominal" placeholder="Contoh: 50.000" />
    </div>

    <div class="form-group">
      <label for="keterangan">Keterangan</label>
      <input type="text" id="keterangan" placeholder="Contoh: Beli makan siang" />
    </div>

    <div class="button-group">
      <button id="btn-kembali">← Kembali</button>
      <button id="btn-lanjut">✔️ Lanjut</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        const nominalInput = document.getElementById("nominal");

// Format angka saat mengetik
        nominalInput.addEventListener("input", function (e) {
        let value = e.target.value.replace(/[^\d]/g, "");
        e.target.value = formatRupiah(value);
        });

        // Fungsi format angka ke format Rp (tanpa Rp)
        function formatRupiah(angka) {
        return angka.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }


      const bulanIndex = localStorage.getItem("bulanTerpilih");
      const semuaBulan = JSON.parse(localStorage.getItem("catatanBulan")) || [];
      const dataBulan = semuaBulan[bulanIndex];

      if (!dataBulan) {
        alert("Data bulan tidak ditemukan. Silakan kembali ke halaman utama.");
        window.location.href = "index.html";
        return;
      }

      // Atur tanggal default berdasarkan bulan & tahun terpilih
      const inputTanggal = document.getElementById("tanggal");
      const today = new Date();
      today.setFullYear(dataBulan.tahun);
      today.setMonth(getMonthIndex(dataBulan.bulan));
      inputTanggal.value = today.toISOString().split("T")[0];

      // Tombol kembali
      document.getElementById("btn-kembali").addEventListener("click", () => {
        window.location.href = "pengeluaran.html";
      });

      // Tombol lanjut (tambah data)
      document.getElementById("btn-lanjut").addEventListener("click", () => {
        const tanggal = document.getElementById("tanggal").value;
        const nominalStr = document.getElementById("nominal").value.replace(/\./g, "");
        const nominal = parseInt(nominalStr);

        const keterangan = document.getElementById("keterangan").value.trim();

        if (!tanggal || isNaN(nominal) || !keterangan) {
          alert("Harap isi semua data dengan benar!");
          return;
        }

        const item = {
          tanggal: formatTanggalIndonesia(tanggal),
          nominal,
          keterangan
        };

        const key = `pengeluaran-${bulanIndex}`;
        const list = JSON.parse(localStorage.getItem(key)) || [];
        list.push(item);
        localStorage.setItem(key, JSON.stringify(list));
        window.location.href = "pengeluaran.html";
      });

      function getMonthIndex(namaBulan) {
        const bulanArray = [
          "Januari", "Februari", "Maret", "April", "Mei", "Juni",
          "Juli", "Agustus", "September", "Oktober", "November", "Desember"
        ];
        return bulanArray.indexOf(namaBulan);
      }

      function formatTanggalIndonesia(tgl) {
        const hariArray = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
        const bulanArray = [
          "Januari", "Februari", "Maret", "April", "Mei", "Juni",
          "Juli", "Agustus", "September", "Oktober", "November", "Desember"
        ];
        const date = new Date(tgl);
        const hari = hariArray[date.getDay()];
        const tanggal = date.getDate();
        const bulan = bulanArray[date.getMonth()];
        const tahun = date.getFullYear();
        return `${hari}, ${tanggal} ${bulan} ${tahun}`;
      }
    });
  </script>
</body>
</html>
